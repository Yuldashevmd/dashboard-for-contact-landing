import{r as s,j as e,B as m,q as I}from"./index-8cf2d033.js";import{u as b,T as C}from"./index-c92049f1.js";import{F as d,u as D}from"./useMutation-576a8117.js";import{I as N,v as q,w as S,x as P,f as z,T as f,y as A}from"./actions-210159a0.js";import{I as h}from"./constants-0162285d.js";import{Q as E}from"./react-toastify.esm-886a0e0b.js";import{D as K,P as L,T as Q}from"./index-1417cac4.js";import{A as R}from"./index-6ebbe47d.js";import"./Sider-e3d14542.js";const X=()=>{const[u]=d.useForm(),[p,r]=s.useState(null),[g,n]=s.useState(null),[j,i]=s.useState(!1),[o,x]=s.useState(null),{data:l,isPending:w}=b({queryKey:["team"],queryFn:A,refetchOnWindowFocus:!1}),c=D({mutationFn:t=>q(t)}),T=async t=>{c.mutate(t.id),c.isSuccess&&(I.invalidateQueries({queryKey:["team"]}),E.success(c.data,{position:"bottom-right"}))},_=async()=>{const t=new FormData;t.append("image",p);const a=await S(o.id,t);console.log(a,"res")},k=async()=>{const t=new FormData;t.append("image",p);const a=await P(t);console.log(a,"res")},v=async t=>{const a=await z(t.target.files[0]);r(t.target.files[0]),n(a)},y=()=>{s.startTransition(()=>{r(null),n(null),i(!1),x(null),u.resetFields()})},F=[{title:"Фото",dataIndex:"our_team_image_link",key:"our_team_image_link",render:t=>e.jsx(R,{src:h+""+t,size:80,shape:"square",style:{boxShadow:"0 0 10px 1px lightgrey"}})},{title:"Дата создания",dataIndex:"create_data",key:"create_data",flex:1,align:"center"},{title:"Дейтсвия",dataIndex:"action",key:"action",flex:1,align:"center",render:(t,a)=>e.jsxs("div",{className:"d-flex align-center justify-center gap-x-1",children:[e.jsx(f,{title:"Изменить",placement:"top",children:e.jsx(L,{cursor:"pointer",size:20,color:"#252525",onClick:()=>{i(!0),x(a),r(a.our_team_image_link),n(h+""+a.our_team_image_link)}})}),e.jsx(f,{title:"Удалить",placement:"top",children:e.jsx(Q,{cursor:"pointer",size:20,color:"#252525",onClick:()=>T(a)})})]})}];return e.jsxs("main",{className:"team",children:[e.jsx("h1",{children:"Team"}),e.jsxs("div",{className:"history-table m-t-2",children:[e.jsx("div",{className:"w-100 d-flex align-center justify-end",children:e.jsx(m,{className:"m-y-1",type:"primary",onClick:()=>i(!0),children:"Создать +"})}),e.jsx(C,{loading:w,column:F,row:l==null?void 0:l.map(t=>({...t,key:t.id}))})]}),e.jsx(K,{history:{record:o,open:j,closeDrawer:y,preview:g,title:"Добавить",footer:e.jsxs("div",{className:"d-flex align-center gap-x-2",children:[e.jsx(m,{type:"primary",form:"history-form",htmlType:"submit",children:"Сохранить"}),e.jsx(m,{danger:!0,onClick:y,children:"Отмена"})]})},children:e.jsx(d,{typeof:"form-data",onFinish:o?_:k,form:u,id:"history-form",layout:"vertical",children:e.jsx(d.Item,{name:"image",label:"Картинка",children:e.jsx(N,{type:"file",onChange:v})})})})]})};export{X as default};
