import{r as i,j as e,B as y,q as p}from"./index-09831358.js";import{u as C,T as D}from"./index-c0bdb8e7.js";import{F as r,u as N}from"./useMutation-e6a1004b.js";import{I as f,c as H,e as K,h as S,f as P,T as g,i as Q}from"./actions-53774f65.js";import{I as j}from"./constants-0162285d.js";import{D as z,P as A,T as E}from"./index-93934f2f.js";import{A as L}from"./index-5c3f76de.js";import"./Sider-1d4f0c6e.js";import"./react-toastify.esm-cdfe1485.js";const X=()=>{const[n]=r.useForm(),[h,l]=i.useState(null),[w,o]=i.useState(null),[k,c]=i.useState(!1),[d,x]=i.useState(null),{data:m,isPending:v}=C({queryKey:["histories"],queryFn:Q,refetchOnWindowFocus:!1}),F=N({mutationFn:t=>H(t)}),I=async t=>{F.mutate(t.id),p.invalidateQueries({queryKey:["histories"]})},T=async t=>{const s=new FormData;s.append("title",t.title),s.append("history_image",h);const u=await K(d.id,s);p.invalidateQueries({queryKey:["histories"]}),a(),console.log(u,"res")},_=async t=>{const s=new FormData;s.append("title",t.title),s.append("history_image",h);const u=await S(s);p.invalidateQueries({queryKey:["histories"]}),a(),console.log(u,"res")},b=async t=>{const s=await P(t.target.files[0]);l(t.target.files[0]),o(s)},a=()=>{i.startTransition(()=>{l(null),o(null),c(!1),x(null),n.resetFields()})},q=[{title:"Фото",dataIndex:"image_link",key:"image_link",render:t=>e.jsx(L,{src:j+""+t,size:80,shape:"square",style:{boxShadow:"0 0 10px 1px lightgrey"}})},{title:"Название",dataIndex:"title",key:"title",flex:1,align:"center"},{title:"Дата создания",dataIndex:"create_data",key:"create_data",flex:1,align:"center"},{title:"Дейтсвия",dataIndex:"action",key:"action",flex:1,align:"center",render:(t,s)=>e.jsxs("div",{className:"d-flex align-center justify-center gap-x-1",children:[e.jsx(g,{title:"Изменить",placement:"top",children:e.jsx(A,{cursor:"pointer",size:20,color:"#252525",onClick:()=>{c(!0),x(s),n.setFieldValue("title",s.title),l(s.image_link),o(j+""+s.image_link)}})}),e.jsx(g,{title:"Удалить",placement:"top",children:e.jsx(E,{cursor:"pointer",size:20,color:"#252525",onClick:()=>I(s)})})]})}];return e.jsxs("main",{className:"history",children:[e.jsx("h1",{children:"History"}),e.jsxs("div",{className:"history-table m-t-2",children:[e.jsx("div",{className:"w-100 d-flex align-center justify-end",children:e.jsx(y,{className:"m-y-1",type:"primary",onClick:()=>c(!0),children:"Создать +"})}),e.jsx(D,{column:q,row:m==null?void 0:m.map(t=>({...t,key:t.id})),loading:v})]}),e.jsx(z,{history:{record:d,open:k,closeDrawer:a,preview:w,title:"Добавить",footer:e.jsxs("div",{className:"d-flex align-center gap-x-2",children:[e.jsx(y,{type:"primary",form:"history-form",htmlType:"submit",children:"Сохранить"}),e.jsx(y,{danger:!0,onClick:a,children:"Отмена"})]})},children:e.jsxs(r,{typeof:"form-data",onFinish:d?T:_,form:n,id:"history-form",layout:"vertical",children:[e.jsx(r.Item,{name:"title",label:"Название",children:e.jsx(f,{type:"text"})}),e.jsx(r.Item,{name:"image",label:"Картинка",children:e.jsx(f,{type:"file",onChange:b})})]})})]})};export{X as default};
