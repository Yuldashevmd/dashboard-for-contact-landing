import{F as n,r as l,j as e,B as m,T as N,I as s,q as y,l as _,i as f,m as C}from"./index-7f3064dd.js";import{u as D}from"./useQuery-3eb598f2.js";import{u as T}from"./useMutation-a97383b0.js";import{n as V,o as E,p as K,f as Q,q as z}from"./actions-c21add60.js";import{D as A,T as L}from"./index-3cb1c3aa.js";import{A as P}from"./index-fc4bc3e3.js";const G=()=>{const[r]=n.useForm(),[h,d]=l.useState(null),[g,c]=l.useState(null),[F,o]=l.useState(!1),[p,j]=l.useState(null),{data:x,isPending:I}=D({queryKey:["services"],queryFn:z,refetchOnWindowFocus:!1}),q=T({mutationFn:i=>V(i)}),b=async i=>{q.mutate(i.id),y.invalidateQueries({queryKey:["services"]})},k=async i=>{const t=new FormData;t.append("title",i.title),t.append("title_ru",i.title_ru),t.append("title_en",i.title_en),t.append("price",i.price),t.append("text",i.text),t.append("text_ru",i.text_ru),t.append("text_en",i.text_en),t.append("servise_image",h);const u=await E(p.id,t);y.invalidateQueries({queryKey:["services"]}),a(),console.log(u,"res")},v=async i=>{const t=new FormData;t.append("title",i.title),t.append("title_ru",i.title_ru),t.append("title_en",i.title_en),t.append("price",i.price),t.append("text",i.text),t.append("text_ru",i.text_ru),t.append("text_en",i.text_en),t.append("servise_image",h);const u=await K(t);y.invalidateQueries({queryKey:["services"]}),a(),console.log(u,"res")},w=async i=>{const t=await Q(i.target.files[0]);d(i.target.files[0]),c(t)},a=()=>{d(null),c(null),o(!1),j(null),r.resetFields()},S=[{title:"Название",dataIndex:"title",key:"title",flex:1},{title:"Сумма",dataIndex:"price",key:"price",flex:1},{title:"Текст",dataIndex:"text",key:"text",flex:1},{title:"Фото",dataIndex:"image_link",key:"image_link",render:i=>e.jsx(P,{src:_+""+i,size:80,shape:"square",style:{boxShadow:"0 0 10px 1px lightgrey"}}),align:"center"},{title:"Дата создания",dataIndex:"create_data",key:"create_data",flex:1,align:"center"},{title:"Дейтсвия",dataIndex:"action",key:"action",flex:1,align:"center",render:(i,t)=>e.jsxs("div",{className:"d-flex align-center justify-center gap-x-1",children:[e.jsx(f,{title:"Изменить",placement:"top",children:e.jsx(C,{cursor:"pointer",size:20,color:"#252525",onClick:()=>{o(!0),j(t),r.setFieldValue("title",t.title),r.setFieldValue("title_ru",t.title_ru),r.setFieldValue("title_en",t.title_en),r.setFieldValue("price",t.price),r.setFieldValue("text",t.text),r.setFieldValue("text_ru",t.text_ru),r.setFieldValue("text_en",t.text_en),d(t.image_link),c(_+""+t.image_link)}})}),e.jsx(f,{title:"Удалить",placement:"top",children:e.jsx(L,{cursor:"pointer",size:20,color:"#252525",onClick:()=>b(t)})})]})}];return e.jsxs("main",{className:"services",children:[e.jsx("h1",{children:"Services"}),e.jsxs("div",{className:"services-table m-t-2",children:[e.jsx("div",{className:"w-100 d-flex align-center justify-end",children:e.jsx(m,{className:"m-y-1",type:"primary",onClick:()=>o(!0),children:"Создать +"})}),e.jsx(N,{loading:I,column:S,row:x==null?void 0:x.map(i=>({...i,key:i.id}))})]}),e.jsx(A,{history:{record:p,open:F,closeDrawer:a,preview:g,title:"Добавить",footer:e.jsxs("div",{className:"d-flex align-center gap-x-2",children:[e.jsx(m,{type:"primary",form:"history-form",htmlType:"submit",children:"Сохранить"}),e.jsx(m,{danger:!0,onClick:a,children:"Отмена"})]})},children:e.jsxs(n,{typeof:"form-data",onFinish:p?k:v,form:r,id:"history-form",layout:"vertical",children:[e.jsx(n.Item,{name:"title",label:"Название UZ",required:!0,children:e.jsx(s,{type:"text"})}),e.jsx(n.Item,{name:"title_ru",label:"Название РУ",required:!0,children:e.jsx(s,{type:"text"})}),e.jsx(n.Item,{name:"title_en",label:"Название EN",required:!0,children:e.jsx(s,{type:"text"})}),e.jsx(n.Item,{name:"price",label:"Сумма",required:!0,children:e.jsx(s,{type:"number"})}),e.jsx(n.Item,{name:"text",label:"Текст UZ",required:!0,children:e.jsx(s,{type:"text"})}),e.jsx(n.Item,{name:"text_ru",label:"Текст РУ",required:!0,children:e.jsx(s,{type:"text"})}),e.jsx(n.Item,{name:"text_en",label:"Текст EN",required:!0,children:e.jsx(s,{type:"text"})}),e.jsx(n.Item,{name:"image",label:e.jsxs("p",{children:["Картинка ",e.jsx("span",{style:{color:"red"},children:"(319 X 187 пикс)"})]}),children:e.jsx(s,{type:"file",onChange:w})})]})})]})};export{G as default};
