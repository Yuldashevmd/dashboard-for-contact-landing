import{F as n,r,j as e,B as p,T as D,I as f,q as x,l as g,i as j,m as N}from"./index-7f3064dd.js";import{u as _}from"./useQuery-3eb598f2.js";import{u as A}from"./useMutation-a97383b0.js";import{z as K,A as S,B as z,f as Q,C as B}from"./actions-c21add60.js";import{D as E,T as L}from"./index-3cb1c3aa.js";import{A as P}from"./index-fc4bc3e3.js";const W=()=>{const[i]=n.useForm(),[y,l]=r.useState(null),[w,o]=r.useState(null),[C,m]=r.useState(!1),[c,h]=r.useState(null),{data:d,isPending:k}=_({queryKey:["comment"],queryFn:B,refetchOnWindowFocus:!1}),v=A({mutationFn:t=>K(t)}),F=async t=>{v.mutate(t.id),x.invalidateQueries({queryKey:["comment"]})},I=async t=>{const a=new FormData;a.append("camment",t.comment),a.append("image",y);const u=await S(c.id,a);x.invalidateQueries({queryKey:["comment"]}),s(),console.log(u,"res")},q=async t=>{const a=new FormData;a.append("camment",t.comment),a.append("image",y);const u=await z(a);x.invalidateQueries({queryKey:["comment"]}),s(),console.log(u,"res")},b=async t=>{const a=await Q(t.target.files[0]);l(t.target.files[0]),o(a)},s=()=>{l(null),o(null),m(!1),h(null),i.resetFields()},T=[{title:"Фото",dataIndex:"image_link",key:"image_link",render:t=>e.jsx(P,{src:g+""+t,size:80,shape:"square",style:{boxShadow:"0 0 10px 1px lightgrey"}})},{title:"Дата создания",dataIndex:"create_data",key:"create_data",flex:1,align:"center"},{title:"Комментария",dataIndex:"camment",key:"camment",flex:1,align:"center"},{title:"Дейтсвия",dataIndex:"action",key:"action",flex:1,align:"center",render:(t,a)=>e.jsxs("div",{className:"d-flex align-center justify-center gap-x-1",children:[e.jsx(j,{title:"Изменить",placement:"top",children:e.jsx(N,{cursor:"pointer",size:20,color:"#252525",onClick:()=>{m(!0),h(a),i.setFieldValue("comment",a.camment),l(a.image_link),o(g+""+a.image_link)}})}),e.jsx(j,{title:"Удалить",placement:"top",children:e.jsx(L,{cursor:"pointer",size:20,color:"#252525",onClick:()=>F(a)})})]})}];return e.jsxs("main",{className:"comments",children:[e.jsx("h1",{children:"Comments"}),e.jsxs("div",{className:"comments-table m-t-2",children:[e.jsx("div",{className:"w-100 d-flex align-center justify-end",children:e.jsx(p,{className:"m-y-1",type:"primary",onClick:()=>m(!0),children:"Создать +"})}),e.jsx(D,{loading:k,column:T,row:d==null?void 0:d.map(t=>({...t,key:t.id}))})]}),e.jsx(E,{history:{record:c,open:C,closeDrawer:s,preview:w,title:"Добавить",footer:e.jsxs("div",{className:"d-flex align-center gap-x-2",children:[e.jsx(p,{type:"primary",form:"history-form",htmlType:"submit",children:"Сохранить"}),e.jsx(p,{danger:!0,onClick:s,children:"Отмена"})]})},children:e.jsxs(n,{typeof:"form-data",onFinish:c?I:q,form:i,id:"history-form",layout:"vertical",children:[e.jsx(n.Item,{name:"comment",label:"Название",rules:[{required:!0,message:"",whitespace:!0}],children:e.jsx(f.TextArea,{type:"text"})}),e.jsx(n.Item,{name:"image",label:e.jsxs("p",{children:["Картинка ",e.jsx("span",{style:{color:"red"},children:"(160 X 80 пикс)"})]}),children:e.jsx(f,{type:"file",onChange:b})})]})})]})};export{W as default};
