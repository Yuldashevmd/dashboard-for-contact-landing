import{r as s,j as e,B as d,q as p}from"./index-09831358.js";import{u as C,T as b}from"./index-c0bdb8e7.js";import{F as u,u as D}from"./useMutation-e6a1004b.js";import{I as N,j as _,k as K,l as S,f as Q,T as f,m as z}from"./actions-53774f65.js";import{I as h}from"./constants-0162285d.js";import{D as A,P as E,T as L}from"./index-93934f2f.js";import{A as R}from"./index-5c3f76de.js";import"./Sider-1d4f0c6e.js";import"./react-toastify.esm-cdfe1485.js";const X=()=>{const[n]=u.useForm(),[y,i]=s.useState(null),[g,l]=s.useState(null),[j,o]=s.useState(!1),[c,x]=s.useState(null),{data:m,isPending:w}=C({queryKey:["partners"],queryFn:z,refetchOnWindowFocus:!1}),k=D({mutationFn:t=>_(t)}),v=async t=>{k.mutate(t.id),p.invalidateQueries({queryKey:["partners"]})},F=async t=>{const a=new FormData;a.append("camment",t.comment),a.append("image",y);const q=await K(c.id,a);p.invalidateQueries({queryKey:["partners"]}),r(),console.log(q,"res")},P=async()=>{const t=new FormData;t.append("image",y);const a=await S(t);p.invalidateQueries({queryKey:["partners"]}),r(),console.log(a,"res")},I=async t=>{const a=await Q(t.target.files[0]);i(t.target.files[0]),l(a)},r=()=>{s.startTransition(()=>{i(null),l(null),o(!1),x(null),n.resetFields()})},T=[{title:"Фото",dataIndex:"image_link",key:"image_link",render:t=>e.jsx(R,{src:h+""+t,size:80,shape:"square",style:{boxShadow:"0 0 10px 1px lightgrey"}})},{title:"Дата создания",dataIndex:"create_data",key:"create_data",flex:1,align:"center"},{title:"Дейтсвия",dataIndex:"action",key:"action",flex:1,align:"center",render:(t,a)=>e.jsxs("div",{className:"d-flex align-center justify-center gap-x-1",children:[e.jsx(f,{title:"Изменить",placement:"top",children:e.jsx(E,{cursor:"pointer",size:20,color:"#252525",onClick:()=>{o(!0),x(a),n.setFieldValue("comment",a.camment),i(a.image_link),l(h+""+a.image_link)}})}),e.jsx(f,{title:"Удалить",placement:"top",children:e.jsx(L,{cursor:"pointer",size:20,color:"#252525",onClick:()=>v(a)})})]})}];return e.jsxs("main",{className:"partners",children:[e.jsx("h1",{children:"Partners"}),e.jsxs("div",{className:"partners-table m-t-2",children:[e.jsx("div",{className:"w-100 d-flex align-center justify-end",children:e.jsx(d,{className:"m-y-1",type:"primary",onClick:()=>o(!0),children:"Создать +"})}),e.jsx(b,{loading:w,column:T,row:m==null?void 0:m.map(t=>({...t,key:t.id}))})]}),e.jsx(A,{history:{record:c,open:j,closeDrawer:r,preview:g,title:"Добавить",footer:e.jsxs("div",{className:"d-flex align-center gap-x-2",children:[e.jsx(d,{type:"primary",form:"history-form",htmlType:"submit",children:"Сохранить"}),e.jsx(d,{danger:!0,onClick:r,children:"Отмена"})]})},children:e.jsx(u,{typeof:"form-data",onFinish:c?F:P,form:n,id:"history-form",layout:"vertical",children:e.jsx(u.Item,{name:"image",label:"Картинка",children:e.jsx(N,{type:"file",onChange:I})})})})]})};export{X as default};
