import{r as n,j as e,B as x,q as T}from"./index-8cf2d033.js";import{u as C,T as N}from"./index-c92049f1.js";import{F as i,u as q}from"./useMutation-576a8117.js";import{I as l,n as D,o as E,p as P,f as z,T as j,q as A}from"./actions-210159a0.js";import{I as g}from"./constants-0162285d.js";import{Q as K}from"./react-toastify.esm-886a0e0b.js";import{D as L,P as Q,T as R}from"./index-1417cac4.js";import{A as V}from"./index-6ebbe47d.js";import"./Sider-e3d14542.js";const X=()=>{const[a]=i.useForm(),[y,r]=n.useState(null),[_,o]=n.useState(null),[v,c]=n.useState(!1),[d,f]=n.useState(null),{data:m,isPending:w}=C({queryKey:["services"],queryFn:A,refetchOnWindowFocus:!1}),p=q({mutationFn:s=>D(s)}),F=async s=>{p.mutate(s.id),p.isSuccess&&(T.invalidateQueries({queryKey:["services"]}),K.success(p.data,{position:"bottom-right"}))},k=async s=>{const t=new FormData;t.append("title",s.title),t.append("title_ru",s.title_ru),t.append("title_en",s.title_en),t.append("servise_image",y);const u=await E(d.id,t);console.log(u,"res")},I=async s=>{const t=new FormData;t.append("title",s.title),t.append("title_ru",s.title_ru),t.append("title_en",s.title_en),t.append("servise_image",y);const u=await P(t);console.log(u,"res")},S=async s=>{const t=await z(s.target.files[0]);r(s.target.files[0]),o(t)},h=()=>{n.startTransition(()=>{r(null),o(null),c(!1),f(null),a.resetFields()})},b=[{title:"Название",dataIndex:"title",key:"title",flex:1},{title:"Фото",dataIndex:"image_link",key:"image_link",render:s=>e.jsx(V,{src:g+""+s,size:80,shape:"square",style:{boxShadow:"0 0 10px 1px lightgrey"}}),align:"center"},{title:"Дата создания",dataIndex:"create_data",key:"create_data",flex:1,align:"center"},{title:"Дейтсвия",dataIndex:"action",key:"action",flex:1,align:"center",render:(s,t)=>e.jsxs("div",{className:"d-flex align-center justify-center gap-x-1",children:[e.jsx(j,{title:"Изменить",placement:"top",children:e.jsx(Q,{cursor:"pointer",size:20,color:"#252525",onClick:()=>{c(!0),f(t),a.setFieldValue("title",t.title),a.setFieldValue("title_ru",t.title_ru),a.setFieldValue("title_en",t.title_en),r(t.image_link),o(g+""+t.image_link)}})}),e.jsx(j,{title:"Удалить",placement:"top",children:e.jsx(R,{cursor:"pointer",size:20,color:"#252525",onClick:()=>F(t)})})]})}];return e.jsxs("main",{className:"services",children:[e.jsx("h1",{children:"Services"}),e.jsxs("div",{className:"services-table m-t-2",children:[e.jsx("div",{className:"w-100 d-flex align-center justify-end",children:e.jsx(x,{className:"m-y-1",type:"primary",onClick:()=>c(!0),children:"Создать +"})}),e.jsx(N,{loading:w,column:b,row:m==null?void 0:m.map(s=>({...s,key:s.id}))})]}),e.jsx(L,{history:{record:d,open:v,closeDrawer:h,preview:_,title:"Добавить",footer:e.jsxs("div",{className:"d-flex align-center gap-x-2",children:[e.jsx(x,{type:"primary",form:"history-form",htmlType:"submit",children:"Сохранить"}),e.jsx(x,{danger:!0,onClick:h,children:"Отмена"})]})},children:e.jsxs(i,{typeof:"form-data",onFinish:d?k:I,form:a,id:"history-form",layout:"vertical",children:[e.jsx(i.Item,{name:"title",label:"Название UZ",children:e.jsx(l,{type:"text"})}),e.jsx(i.Item,{name:"title_ru",label:"Название РУ",children:e.jsx(l,{type:"text"})}),e.jsx(i.Item,{name:"title_en",label:"Название EN",children:e.jsx(l,{type:"text"})}),e.jsx(i.Item,{name:"image",label:"Картинка",children:e.jsx(l,{type:"file",onChange:S})})]})})]})};export{X as default};
