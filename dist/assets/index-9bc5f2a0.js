import{r as t,j as e,B as c,q as m}from"./index-09831358.js";import{u as b,T as q}from"./index-c0bdb8e7.js";import{F as u,u as C}from"./useMutation-e6a1004b.js";import{I as D,d as N,u as H,a as K,f as S,T as x,b as A}from"./actions-53774f65.js";import{I as f}from"./constants-0162285d.js";import{D as P,P as Q,T as z}from"./index-93934f2f.js";import{A as E}from"./index-5c3f76de.js";import"./Sider-1d4f0c6e.js";import"./react-toastify.esm-cdfe1485.js";const V=()=>{const[p]=u.useForm(),[h,n]=t.useState(null),[g,i]=t.useState(null),[j,l]=t.useState(!1),[o,y]=t.useState(null),{data:d,isPending:w}=b({queryKey:["headers"],queryFn:A,refetchOnWindowFocus:!1}),k=C({mutationFn:a=>N(a)}),v=async a=>{await k.mutateAsync(a.id),m.invalidateQueries({queryKey:["headers"]})},_=async()=>{const a=new FormData;a.append("header_image",h);const s=await H(o.id,a);m.invalidateQueries({queryKey:["headers"]}),r(),console.log(s,"res")},F=async()=>{const a=new FormData;a.append("header_image",h);const s=await K(a);m.invalidateQueries({queryKey:["headers"]}),r(),console.log(s,"res")},I=async a=>{const s=await S(a.target.files[0]);n(a.target.files[0]),i(s)},r=()=>{t.startTransition(()=>{n(null),i(null),l(!1),y(null),p.resetFields()})},T=[{title:"Фото",dataIndex:"haeder_image_link",key:"haeder_image_link",render:a=>e.jsx(E,{src:f+""+a,size:80,shape:"square",style:{boxShadow:"0 0 10px 1px lightgrey"}})},{title:"Дата создания",dataIndex:"create_data",key:"create_data",flex:1,align:"center"},{title:"Дейтсвия",dataIndex:"action",key:"action",flex:1,align:"center",render:(a,s)=>e.jsxs("div",{className:"d-flex align-center justify-center gap-x-1",children:[e.jsx(x,{title:"Изменить",placement:"top",children:e.jsx(Q,{cursor:"pointer",size:20,color:"#252525",onClick:()=>{l(!0),y(s),n(s.image_link),i(f+""+s.haeder_image_link)}})}),e.jsx(x,{title:"Удалить",placement:"top",children:e.jsx(z,{cursor:"pointer",size:20,color:"#252525",onClick:()=>v(s)})})]})}];return e.jsxs("main",{className:"headers",children:[e.jsx("h1",{children:"Headers"}),e.jsxs("div",{className:"headers-table m-t-2",children:[e.jsx("div",{className:"w-100 d-flex align-center justify-end",children:e.jsx(c,{className:"m-y-1",type:"primary",onClick:()=>l(!0),children:"Создать +"})}),e.jsx(q,{loading:w,column:T,row:d==null?void 0:d.map(a=>({...a,key:a.id}))})]}),e.jsx(P,{history:{record:o,open:j,closeDrawer:r,preview:g,title:"Добавить",footer:e.jsxs("div",{className:"d-flex align-center gap-x-2",children:[e.jsx(c,{type:"primary",form:"history-form",htmlType:"submit",children:"Сохранить"}),e.jsx(c,{danger:!0,onClick:r,children:"Отмена"})]})},children:e.jsx(u,{typeof:"form-data",onFinish:o?_:F,form:p,id:"history-form",layout:"vertical",children:e.jsx(u.Item,{name:"image",label:"Картинка",children:e.jsx(D,{type:"file",onChange:I})})})})]})};export{V as default};
