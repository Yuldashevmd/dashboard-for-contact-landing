import{r as s,j as e,B as u,q as x}from"./index-77416aa9.js";import{u as C,T as D}from"./index-d1ec4b0d.js";import{F as r,u as N}from"./useMutation-030d6ef5.js";import{I as h,j as _,k as K,l as S,f as A,T as g,m as Q}from"./actions-5b814d08.js";import{I as j}from"./constants-0162285d.js";import{D as z,P as E,T as L}from"./index-fc034bb5.js";import{A as R}from"./index-3ac41cdc.js";import"./Sider-03914fe4.js";import"./react-toastify.esm-5034558b.js";const X=()=>{const[i]=r.useForm(),[y,l]=s.useState(null),[k,o]=s.useState(null),[w,c]=s.useState(!1),[m,f]=s.useState(null),{data:d,isPending:v}=C({queryKey:["partners"],queryFn:Q,refetchOnWindowFocus:!1}),F=N({mutationFn:t=>_(t)}),I=async t=>{F.mutate(t.id),x.invalidateQueries({queryKey:["partners"]})},P=async t=>{const a=new FormData;a.append("camment",t.comment),a.append("image",y);const p=await K(m.id,a);x.invalidateQueries({queryKey:["partners"]}),n(),console.log(p,"res")},T=async t=>{const a=new FormData;a.append("camment",t.comment),a.append("image",y);const p=await S(a);x.invalidateQueries({queryKey:["partners"]}),n(),console.log(p,"res")},b=async t=>{const a=await A(t.target.files[0]);l(t.target.files[0]),o(a)},n=()=>{s.startTransition(()=>{l(null),o(null),c(!1),f(null),i.resetFields()})},q=[{title:"Фото",dataIndex:"image_link",key:"image_link",render:t=>e.jsx(R,{src:j+""+t,size:80,shape:"square",style:{boxShadow:"0 0 10px 1px lightgrey"}})},{title:"Дата создания",dataIndex:"create_data",key:"create_data",flex:1,align:"center"},{title:"Комментария",dataIndex:"camment",key:"camment",flex:1,align:"center"},{title:"Дейтсвия",dataIndex:"action",key:"action",flex:1,align:"center",render:(t,a)=>e.jsxs("div",{className:"d-flex align-center justify-center gap-x-1",children:[e.jsx(g,{title:"Изменить",placement:"top",children:e.jsx(E,{cursor:"pointer",size:20,color:"#252525",onClick:()=>{c(!0),f(a),i.setFieldValue("comment",a.camment),l(a.image_link),o(j+""+a.image_link)}})}),e.jsx(g,{title:"Удалить",placement:"top",children:e.jsx(L,{cursor:"pointer",size:20,color:"#252525",onClick:()=>I(a)})})]})}];return e.jsxs("main",{className:"partners",children:[e.jsx("h1",{children:"Partners"}),e.jsxs("div",{className:"partners-table m-t-2",children:[e.jsx("div",{className:"w-100 d-flex align-center justify-end",children:e.jsx(u,{className:"m-y-1",type:"primary",onClick:()=>c(!0),children:"Создать +"})}),e.jsx(D,{loading:v,column:q,row:d==null?void 0:d.map(t=>({...t,key:t.id}))})]}),e.jsx(z,{history:{record:m,open:w,closeDrawer:n,preview:k,title:"Добавить",footer:e.jsxs("div",{className:"d-flex align-center gap-x-2",children:[e.jsx(u,{type:"primary",form:"history-form",htmlType:"submit",children:"Сохранить"}),e.jsx(u,{danger:!0,onClick:n,children:"Отмена"})]})},children:e.jsxs(r,{typeof:"form-data",onFinish:m?P:T,form:i,id:"history-form",layout:"vertical",children:[e.jsx(r.Item,{name:"comment",label:"Название",children:e.jsx(h.TextArea,{type:"text"})}),e.jsx(r.Item,{name:"image",label:"Картинка",children:e.jsx(h,{type:"file",onChange:b})})]})})]})};export{X as default};
