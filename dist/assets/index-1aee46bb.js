import{r as s,j as e,B as u,q as C}from"./index-8cf2d033.js";import{u as D,T as N}from"./index-c92049f1.js";import{F as n,u as _}from"./useMutation-576a8117.js";import{I as h,j as q,k as S,l as A,f as z,T as g,m as E}from"./actions-210159a0.js";import{I as j}from"./constants-0162285d.js";import{Q as K}from"./react-toastify.esm-886a0e0b.js";import{D as L,P as Q,T as R}from"./index-1417cac4.js";import{A as B}from"./index-6ebbe47d.js";import"./Sider-e3d14542.js";const Y=()=>{const[r]=n.useForm(),[x,i]=s.useState(null),[k,l]=s.useState(null),[w,o]=s.useState(!1),[c,y]=s.useState(null),{data:m,isPending:F}=D({queryKey:["partners"],queryFn:E,refetchOnWindowFocus:!1}),d=_({mutationFn:t=>q(t)}),I=async t=>{d.mutate(t.id),d.isSuccess&&(C.invalidateQueries({queryKey:["partners"]}),K.success(d.data,{position:"bottom-right"}))},v=async t=>{const a=new FormData;a.append("camment",t.comment),a.append("image",x);const p=await S(c.id,a);console.log(p,"res")},P=async t=>{const a=new FormData;a.append("camment",t.comment),a.append("image",x);const p=await A(a);console.log(p,"res")},T=async t=>{const a=await z(t.target.files[0]);i(t.target.files[0]),l(a)},f=()=>{s.startTransition(()=>{i(null),l(null),o(!1),y(null),r.resetFields()})},b=[{title:"Фото",dataIndex:"image_link",key:"image_link",render:t=>e.jsx(B,{src:j+""+t,size:80,shape:"square",style:{boxShadow:"0 0 10px 1px lightgrey"}})},{title:"Дата создания",dataIndex:"create_data",key:"create_data",flex:1,align:"center"},{title:"Комментария",dataIndex:"camment",key:"camment",flex:1,align:"center"},{title:"Дейтсвия",dataIndex:"action",key:"action",flex:1,align:"center",render:(t,a)=>e.jsxs("div",{className:"d-flex align-center justify-center gap-x-1",children:[e.jsx(g,{title:"Изменить",placement:"top",children:e.jsx(Q,{cursor:"pointer",size:20,color:"#252525",onClick:()=>{o(!0),y(a),r.setFieldValue("comment",a.camment),i(a.image_link),l(j+""+a.image_link)}})}),e.jsx(g,{title:"Удалить",placement:"top",children:e.jsx(R,{cursor:"pointer",size:20,color:"#252525",onClick:()=>I(a)})})]})}];return e.jsxs("main",{className:"partners",children:[e.jsx("h1",{children:"Partners"}),e.jsxs("div",{className:"partners-table m-t-2",children:[e.jsx("div",{className:"w-100 d-flex align-center justify-end",children:e.jsx(u,{className:"m-y-1",type:"primary",onClick:()=>o(!0),children:"Создать +"})}),e.jsx(N,{loading:F,column:b,row:m==null?void 0:m.map(t=>({...t,key:t.id}))})]}),e.jsx(L,{history:{record:c,open:w,closeDrawer:f,preview:k,title:"Добавить",footer:e.jsxs("div",{className:"d-flex align-center gap-x-2",children:[e.jsx(u,{type:"primary",form:"history-form",htmlType:"submit",children:"Сохранить"}),e.jsx(u,{danger:!0,onClick:f,children:"Отмена"})]})},children:e.jsxs(n,{typeof:"form-data",onFinish:c?v:P,form:r,id:"history-form",layout:"vertical",children:[e.jsx(n.Item,{name:"comment",label:"Название",children:e.jsx(h.TextArea,{type:"text"})}),e.jsx(n.Item,{name:"image",label:"Картинка",children:e.jsx(h,{type:"file",onChange:T})})]})})]})};export{Y as default};
