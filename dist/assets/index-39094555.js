import{r as s,j as e,B as m,q as d}from"./index-77416aa9.js";import{u as q,T as C}from"./index-d1ec4b0d.js";import{F as u,u as b}from"./useMutation-030d6ef5.js";import{I as D,v as N,w as K,x as S,f as P,T as f,y as Q}from"./actions-5b814d08.js";import{I as h}from"./constants-0162285d.js";import{D as z,P as A,T as E}from"./index-fc034bb5.js";import{A as L}from"./index-3ac41cdc.js";import"./Sider-03914fe4.js";import"./react-toastify.esm-5034558b.js";const V=()=>{const[p]=u.useForm(),[y,n]=s.useState(null),[g,i]=s.useState(null),[j,o]=s.useState(!1),[l,x]=s.useState(null),{data:c,isPending:w}=q({queryKey:["team"],queryFn:Q,refetchOnWindowFocus:!1}),T=b({mutationFn:t=>N(t)}),_=async t=>{T.mutate(t.id),d.invalidateQueries({queryKey:["team"]})},v=async()=>{const t=new FormData;t.append("image",y);const a=await K(l.id,t);d.invalidateQueries({queryKey:["team"]}),r(),console.log(a,"res")},k=async()=>{const t=new FormData;t.append("image",y);const a=await S(t);d.invalidateQueries({queryKey:["team"]}),r(),console.log(a,"res")},F=async t=>{const a=await P(t.target.files[0]);n(t.target.files[0]),i(a)},r=()=>{s.startTransition(()=>{n(null),i(null),o(!1),x(null),p.resetFields()})},I=[{title:"Фото",dataIndex:"our_team_image_link",key:"our_team_image_link",render:t=>e.jsx(L,{src:h+""+t,size:80,shape:"square",style:{boxShadow:"0 0 10px 1px lightgrey"}})},{title:"Дата создания",dataIndex:"create_data",key:"create_data",flex:1,align:"center"},{title:"Дейтсвия",dataIndex:"action",key:"action",flex:1,align:"center",render:(t,a)=>e.jsxs("div",{className:"d-flex align-center justify-center gap-x-1",children:[e.jsx(f,{title:"Изменить",placement:"top",children:e.jsx(A,{cursor:"pointer",size:20,color:"#252525",onClick:()=>{o(!0),x(a),n(a.our_team_image_link),i(h+""+a.our_team_image_link)}})}),e.jsx(f,{title:"Удалить",placement:"top",children:e.jsx(E,{cursor:"pointer",size:20,color:"#252525",onClick:()=>_(a)})})]})}];return e.jsxs("main",{className:"team",children:[e.jsx("h1",{children:"Team"}),e.jsxs("div",{className:"history-table m-t-2",children:[e.jsx("div",{className:"w-100 d-flex align-center justify-end",children:e.jsx(m,{className:"m-y-1",type:"primary",onClick:()=>o(!0),children:"Создать +"})}),e.jsx(C,{loading:w,column:I,row:c==null?void 0:c.map(t=>({...t,key:t.id}))})]}),e.jsx(z,{history:{record:l,open:j,closeDrawer:r,preview:g,title:"Добавить",footer:e.jsxs("div",{className:"d-flex align-center gap-x-2",children:[e.jsx(m,{type:"primary",form:"history-form",htmlType:"submit",children:"Сохранить"}),e.jsx(m,{danger:!0,onClick:r,children:"Отмена"})]})},children:e.jsx(u,{typeof:"form-data",onFinish:l?v:k,form:p,id:"history-form",layout:"vertical",children:e.jsx(u.Item,{name:"image",label:"Картинка",children:e.jsx(D,{type:"file",onChange:F})})})})]})};export{V as default};
